# ðŸ—ï¸ Consolidated System Architecture Overview

> This document provides the architectural truth of the codebase, generated by the Hybrid Scaffolding System. It summarizes the structural relationships and defines the adaptive strategy used for context extraction. It is formatted in structured Markdown for superior retrieval performance in NotebookLM [4, 12].

## 1. Foundational Architecture and Centrality Mapping

The architecture is derived from a **Dependency Graph Construction** (Phase 1) which determines the structural importance of each module based on how many other modules rely on it [5, 7].

### 1.1 Core Importance (High Centrality)
Modules with the highest **In-Degree** (number of imports pointing to them) form the core of the system. These are extracted **FULLY** to ensure the foundation is fully understood.
*   **[Repo: github/spec-kit]:** Core Specification Models (High In-Degree)
*   **[Repo: bmad-code-org/BMAD-METHOD]:** Calculation Engine Interfaces (High Centrality Score)

### 1.2 Identified Architectural Layers [5]

| Layer | Definition | Corresponding Metric |
| :--- | :--- | :--- |
| **Layer 0: Entry/Core Points** | High Centrality, Orchestration Logic | High In-Degree, High Priority Rank |
| **Layer 1: Domain/Business Logic** | Balanced Centrality, High Complexity | Cyclomatic Complexity > 10 |
| **Layer 2: Utilities/Leaf Modules**| Low Centrality, Low Complexity | High Out-Degree (imports many, few import it) |

## 2. Adaptive Routing and Context Richness (The Extraction Policy)

The system uses an **Adaptive Routing Decision Engine** (Phase 3) which combines Centrality (importance) and Complexity (difficulty) to decide the extraction policy per file [8, 9]. This approach ensures token efficiency while maximizing semantic context [3, 13].

| Policy | Trigger Criteria | Rationale |
| :--- | :--- | :--- |
| **FULL Extraction** | Centrality > X **AND** Complexity < Y | Core foundational modules; extract complete implementation (80/20 rule) [9, 14]. |
| **SIGNATURE Extraction** | Complexity > Z **OR** High API Count | Complex logic (Cyclomatic Complexity) [7]; extract only function/class signatures + docstrings [9]. |
| **FULL Extraction** | Low Complexity **AND** Low Context Richness | Small Utility functions; extract full content as it has low token cost [9]. |
| **MINIMAL Extraction** | Low Centrality **AND** Low Complexity (but not small) | Larger Utility functions; extract only file-level description or skip code blocks [9]. |
| **SKIP** | Matches `.llmignore` patterns | Exclusionary specification for noise reduction (e.g., tests, lock files) [11, 15]. |

## 3. Context Boundaries and Limitations

The total context is strictly managed to remain below the **500,000-word limit** per source [4, 10].

### 3.1 Key Context Artifacts

*   **Scaffolding Manifest:** The `blueprint.md` provides the domain entity map and context richness detail.
*   **Data Schemas:** Explicit data definitions are in `schemas/extraction_config.py` (Pydantic models) to resolve ambiguity [16].
*   **Decision History:** `docs/adr/` captures the architectural *why* to prevent regression [17, 18].
